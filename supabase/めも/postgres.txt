PostgreSQLé–¢æ•°ã®å½¹å‰²åˆ¥ã¾ã¨ã‚

  ğŸ¯ æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ é–¢æ•°

  ä¸»è¦æ¨è–¦æˆ¦ç•¥

  - get_adaptive_strategy - ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•é‡ã«å¿œã˜ãŸé©å¿œå‹æ¨è–¦
  - get_personalized_strategy - å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° + å—œå¥½åˆ†æ
  - get_popular_strategy - äººæ°—ä½œå“ãƒ™ãƒ¼ã‚¹æ¨è–¦
  - get_personalized_recommendations - ãƒ¡ã‚¤ãƒ³å€‹äººåŒ–æ¨è–¦é–¢æ•°
  - get_personalized_recommendations_with_embeddings - ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¨è–¦

  é¡ä¼¼æ€§åˆ†æ

  - find_similar_users - é¡ä¼¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™ºè¦‹ï¼ˆå”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ç”¨ï¼‰
  - find_similar_works_by_content - ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹é¡ä¼¼ä½œå“æ¤œç´¢
  - get_similar_works_by_content - ä½œå“è©³ç´°ãƒšãƒ¼ã‚¸ç”¨é¡ä¼¼ä½œå“
  - get_hybrid_recommendations - ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¨è–¦

  æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†

  - refresh_recommendation_cache - æ¨è–¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ›´æ–°
  - cron_refresh_recommendations - å®šæœŸæ¨è–¦æ›´æ–°
  - get_recommendation_stats - æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ çµ±è¨ˆæƒ…å ±

  ğŸ“Š çµ±è¨ˆãƒ»é›†è¨ˆé–¢æ•°

  ã‚«ã‚¦ãƒ³ãƒˆè‡ªå‹•æ›´æ–°

  - update_work_likes_count - ã„ã„ã­æ•°è‡ªå‹•æ›´æ–°
  - update_work_comments_count - ã‚³ãƒ¡ãƒ³ãƒˆæ•°è‡ªå‹•æ›´æ–°
  - update_work_views_count - é–²è¦§æ•°è‡ªå‹•æ›´æ–°
  - update_follow_counts - ãƒ•ã‚©ãƒ­ãƒ¼æ•°è‡ªå‹•æ›´æ–°
  - update_user_works_count - ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œå“æ•°è‡ªå‹•æ›´æ–°

  çµ±è¨ˆè¨ˆç®—

  - calculate_bayesian_score - ãƒ™ã‚¤ã‚¸ã‚¢ãƒ³è©•ä¾¡ã‚¹ã‚³ã‚¢è¨ˆç®—
  - update_work_statistics - ä½œå“çµ±è¨ˆãƒ‡ãƒ¼ã‚¿æ›´æ–°
  - update_work_stats - ä½œå“çµ±è¨ˆãƒˆãƒªã‚¬ãƒ¼
  - update_user_stats_from_works - ãƒ¦ãƒ¼ã‚¶ãƒ¼çµ±è¨ˆæ›´æ–°

  ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ

  - update_work_trend_score_on_likes - ã„ã„ã­å¤‰å‹•ã«ã‚ˆã‚‹ãƒˆãƒ¬ãƒ³ãƒ‰ã‚¹ã‚³ã‚¢æ›´æ–°
  - calculate_engagement_score_trigger - ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆã‚¹ã‚³ã‚¢è¨ˆç®—

  ğŸ” æ¤œç´¢ãƒ»ç™ºè¦‹æ©Ÿèƒ½

  æ¤œç´¢æ©Ÿèƒ½

  - search_works_by_embedding - ãƒ™ã‚¯ãƒˆãƒ«åŸ‹ã‚è¾¼ã¿æ¤œç´¢
  - get_valid_recommendations - æœ‰åŠ¹ãªæ¨è–¦ä½œå“å–å¾—

  ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

  - get_popular_works_fallback - æ¨è–¦å¤±æ•—æ™‚ã®äººæ°—ä½œå“è¡¨ç¤º
  - get_simple_personalized - ã‚·ãƒ³ãƒ—ãƒ«å€‹äººåŒ–æ¨è–¦
  - get_simple_popular - ã‚·ãƒ³ãƒ—ãƒ«äººæ°—ä½œå“æ¨è–¦

  ğŸ¤– AIãƒ»æ©Ÿæ¢°å­¦ç¿’é–¢æ•°

  åŸ‹ã‚è¾¼ã¿å‡¦ç†

  - auto_queue_embedding - åŸ‹ã‚è¾¼ã¿å‡¦ç†è‡ªå‹•ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°
  - trigger_embedding_processing - åŸ‹ã‚è¾¼ã¿å‡¦ç†ãƒˆãƒªã‚¬ãƒ¼
  - trigger_embedding_processing_secure - ã‚»ã‚­ãƒ¥ã‚¢åŸ‹ã‚è¾¼ã¿å‡¦ç†

  ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†

  - get_user_preferences_cache - ãƒ¦ãƒ¼ã‚¶ãƒ¼å—œå¥½ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  - update_daily_embedding_cost - AIå‡¦ç†ã‚³ã‚¹ãƒˆç®¡ç†

  ğŸ‘¥ ã‚½ãƒ¼ã‚·ãƒ£ãƒ«æ©Ÿèƒ½

  ãƒ•ã‚©ãƒ­ãƒ¼æ©Ÿèƒ½

  - approve_follow_request - ãƒ•ã‚©ãƒ­ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ‰¿èª
  - reject_follow_request - ãƒ•ã‚©ãƒ­ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ‹’å¦
  - get_follow_status - ãƒ•ã‚©ãƒ­ãƒ¼çŠ¶æ…‹å–å¾—
  - notify_followers_of_new_work - æ–°ä½œå“ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼é€šçŸ¥

  æ¨©é™ç®¡ç†

  - can_view_user_works - ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œå“é–²è¦§æ¨©é™ãƒã‚§ãƒƒã‚¯

  ğŸ“¢ é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 

  é€šçŸ¥ç®¡ç†

  - create_notification - é€šçŸ¥ä½œæˆ
  - clear_test_notifications - ãƒ†ã‚¹ãƒˆé€šçŸ¥å‰Šé™¤

  ğŸ”§ ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†

  å®šæœŸå‡¦ç†

  - auto_publish_scheduled_works - äºˆç´„æŠ•ç¨¿è‡ªå‹•å…¬é–‹
  - cleanup_old_cron_logs - å¤ã„ãƒ­ã‚°å‰Šé™¤

  ãƒ‡ãƒãƒƒã‚°ãƒ»ç›£è¦–

  - debug_http_request - HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‡ãƒãƒƒã‚°
  - debug_vault_key - Vaultè¨­å®šãƒ‡ãƒãƒƒã‚°
  - get_cron_stats - Cronçµ±è¨ˆæƒ…å ±

  ğŸ› ï¸ ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

  æ±ç”¨æ©Ÿèƒ½

  - generate_readable_id - èª­ã¿ã‚„ã™ã„IDç”Ÿæˆ
  - set_updated_at - æ›´æ–°æ—¥æ™‚è¨­å®š
  - update_updated_at_column - æ±ç”¨æ›´æ–°æ—¥æ™‚ãƒˆãƒªã‚¬ãƒ¼

  é–²è¦§æ•°ç®¡ç†

  - increment_views_uuid - é–²è¦§æ•°å¢—åŠ ï¼ˆUUIDç‰ˆï¼‰
  - increment_work_views - ä½œå“é–²è¦§æ•°å¢—åŠ 

  å„ç¨®æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼

  - update_bookmarks_updated_at - ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯æ›´æ–°æ—¥æ™‚
  - update_reading_progress_updated_at - èª­æ›¸é€²æ—æ›´æ–°æ—¥æ™‚
  - update_user_preferences_updated_at - å—œå¥½è¨­å®šæ›´æ–°æ—¥æ™‚

  ---
  ç‰¹å¾´ï¼š
  - æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ ãŒéå¸¸ã«å……å®Ÿï¼ˆ10å€‹ä»¥ä¸Šã®é–¢æ•°ï¼‰
  - è‡ªå‹•é›†è¨ˆã§ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã‚’ä¿è¨¼
  - AIæ©Ÿèƒ½ï¼ˆåŸ‹ã‚è¾¼ã¿ã€ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ï¼‰ã‚’ç©æ¥µæ´»ç”¨
  - ã‚½ãƒ¼ã‚·ãƒ£ãƒ«æ©Ÿèƒ½ã‚‚æœ¬æ ¼çš„ã«å®Ÿè£…
  - ç›£è¦–ãƒ»ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ã‚‚å®Œå‚™

  ã“ã‚Œã¯ä¸­å°è¦æ¨¡ã®Webã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ã¯ã‹ãªã‚Šæœ¬æ ¼çš„ãªDBè¨­è¨ˆã«ãªã£ã¦ã„ã¾ã™ã€‚





â— ç„¡é§„ã£ã½ã„PostgreSQLé–¢æ•°ã®åˆ†æ

  ğŸš¨ ç¢ºå®Ÿã«å‰Šé™¤å¯èƒ½

  1. ãƒ‡ãƒãƒƒã‚°é–¢æ•° (æœ¬ç•ªç’°å¢ƒã§ã¯ä¸è¦)

  - debug_http_request - HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‡ãƒãƒƒã‚°ç”¨
  - debug_vault_key - Vaultè¨­å®šãƒ‡ãƒãƒƒã‚°ç”¨
  - clear_test_notifications - ãƒ†ã‚¹ãƒˆé€šçŸ¥å‰Šé™¤

  2. é‡è¤‡ãƒ»å†—é•·ãªé–²è¦§æ•°é–¢æ•°

  - increment_views_uuid vs increment_work_views
    - åŒã˜æ©Ÿèƒ½ã§å¼•æ•°åãŒé•ã†ã ã‘
    - ã©ã¡ã‚‰ã‹ä¸€ã¤ã«çµ±ä¸€å¯èƒ½

  âš ï¸ å‰Šé™¤æ¤œè¨å€™è£œ

  3. æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ ã®é‡è¤‡

  Simpleç‰ˆãŒå¤šã™ãã‚‹:
  - get_simple_personalized - ãƒ¡ã‚¤ãƒ³æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ ã¨é‡è¤‡
  - get_simple_popular - äººæ°—ä½œå“æ¨è–¦ã¨é‡è¤‡
  - get_popular_works_fallback - ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ã ãŒä½¿ã‚ã‚Œã¦ã„ãªã„å¯èƒ½æ€§

  ä½¿ç”¨çŠ¶æ³ã‚’èª¿æŸ»ã—ã¦å‰Šé™¤æ¤œè¨

  4. æœªä½¿ç”¨ã®å¯èƒ½æ€§ãŒé«˜ã„æ©Ÿèƒ½

  - find_similar_users - é¡ä¼¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™ºè¦‹ï¼ˆè©•ä¾¡æ©Ÿèƒ½ãŒæœªå®Ÿè£…ï¼Ÿï¼‰
  - find_similar_works_by_content vs get_similar_works_by_content
    - æ©Ÿèƒ½ãŒé‡è¤‡ã€ã©ã¡ã‚‰ã‹å‰Šé™¤å¯èƒ½

  5. éå‰°ãªãƒˆãƒªã‚¬ãƒ¼é–¢æ•°

  - trigger_update_likes
  - trigger_update_reviews
    - å®Ÿéš›ã®ãƒˆãƒªã‚¬ãƒ¼ã§ã¯update_work_*_countã‚’ç›´æ¥å‘¼ã‚“ã§ã„ã‚‹
    - ä¸­é–“é–¢æ•°ã¨ã—ã¦ä¸è¦

  ğŸ“Š ä¿ç•™ï¼ˆè¦èª¿æŸ»ï¼‰

  6. ç®¡ç†æ©Ÿèƒ½ï¼ˆä½¿ç”¨é »åº¦æ¬¡ç¬¬ï¼‰

  - manual_refresh_recommendations - æ‰‹å‹•æ¨è–¦æ›´æ–°
  - get_cron_stats - Cronçµ±è¨ˆ
  - cleanup_old_cron_logs - ãƒ­ã‚°ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

  â†’ ç®¡ç†ç”»é¢ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹ãªã‚‰å¿…è¦

  7. åŸ‹ã‚è¾¼ã¿é–¢é€£

  - trigger_embedding_processing vs trigger_embedding_processing_secure
    - ã‚»ã‚­ãƒ¥ã‚¢ç‰ˆãŒã‚ã‚‹ãªã‚‰é€šå¸¸ç‰ˆã¯ä¸è¦ï¼Ÿ

  ğŸ¯ å‰Šé™¤ã®å„ªå…ˆé †ä½

  é«˜å„ªå…ˆåº¦ï¼ˆå³å‰Šé™¤å¯èƒ½ï¼‰

  -- ãƒ‡ãƒãƒƒã‚°é–¢æ•°
  DROP FUNCTION debug_http_request();
  DROP FUNCTION debug_vault_key();
  DROP FUNCTION clear_test_notifications();

  -- é‡è¤‡é–²è¦§æ•°é–¢æ•°ï¼ˆã©ã¡ã‚‰ã‹ç‰‡æ–¹ï¼‰
  DROP FUNCTION increment_views_uuid(uuid);
  -- ã¾ãŸã¯
  -- DROP FUNCTION increment_work_views(uuid);

  ä¸­å„ªå…ˆåº¦ï¼ˆä½¿ç”¨çŠ¶æ³èª¿æŸ»å¾Œï¼‰

  - Simpleç‰ˆæ¨è–¦é–¢æ•°ç¾¤
  - é‡è¤‡é¡ä¼¼ä½œå“æ¤œç´¢é–¢æ•°
  - æœªä½¿ç”¨ãƒˆãƒªã‚¬ãƒ¼é–¢æ•°

  ä½å„ªå…ˆåº¦ï¼ˆç®¡ç†æ©Ÿèƒ½ã¨ã—ã¦ä¿æŒï¼‰

  - Cronç®¡ç†é–¢æ•°
  - æ‰‹å‹•ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥é–¢æ•°

  æ¨å®šå‰Šé™¤åŠ¹æœ: é–¢æ•°æ•°ã‚’15-20å€‹ç¨‹åº¦å‰Šæ¸›å¯èƒ½ã€DBä¿å®ˆæ€§å‘ä¸Š